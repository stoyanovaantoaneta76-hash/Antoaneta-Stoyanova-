name: Nordlys Core CI

on:
  push:
    branches: [main]
    paths:
      - 'nordlys-core/**'
      - '.github/workflows/nordlys-core-ci.yml'
      - '.github/workflows/nordlys-core-test.yml'
  pull_request:
    branches: [main]
    paths:
      - 'nordlys-core/**'
      - '.github/workflows/nordlys-core-ci.yml'
      - '.github/workflows/nordlys-core-test.yml'
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.event_name == 'pull_request' }}

jobs:
  # ============================================
  # Run Tests
  # ============================================
  test:
    name: Run Tests
    uses: ./.github/workflows/nordlys-core-test.yml

  # ============================================
  # Build Wheels (validates they can be built)
  # ============================================
  build_wheels_cpu:
    needs: [test]
    uses: ./.github/workflows/_build-wheels-cpu.yml
    with:
      validate-version: false

  build_wheels_cuda:
    needs: [test]
    uses: ./.github/workflows/_build-wheels-cuda.yml
    with:
      validate-version: false
